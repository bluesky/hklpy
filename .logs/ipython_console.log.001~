# IPython log file

# Sat, 17 Apr 2021 23:03:37
import gi
import numpy.testing
import pint
import pytest

gi.require_version("Hkl", "5.0")
# NOTE: MUST call gi.require_version() BEFORE import hkl
from hkl.calc import A_KEV
from hkl.geometries import SimulatedE4CV


class Fourc(SimulatedE4CV):
    ...
    
# Sat, 17 Apr 2021 23:03:40
fourc = Fourc("", name="fourc")
fourc.wait_for_connection()
fourc._update_calc_energy()
# Sat, 17 Apr 2021 23:04:06
get_ipython().run_line_magic('pinfo', 'fourc.report')
# Sat, 17 Apr 2021 23:04:09
fourc.report
#[Out]# {'position': FourcPseudoPos(h=0.0, k=0.0, l=0.0)}
# Sat, 17 Apr 2021 23:04:28
fourc.pa()
# Sat, 17 Apr 2021 23:04:38
fourc
#[Out]# Fourc(prefix='', name='fourc', settle_time=0.0, timeout=None, egu='', limits=(0, 0), source='computed', read_attrs=['h', 'h.readback', 'h.setpoint', 'k', 'k.readback', 'k.setpoint', 'l', 'l.readback', 'l.setpoint', 'omega', 'chi', 'phi', 'tth'], configuration_attrs=['energy', 'geometry_name', 'class_name', 'UB', 'reflections_details', 'h', 'k', 'l'], concurrent=True)
# Sat, 17 Apr 2021 23:05:16
fourc.energy.get()
#[Out]# 8.0
# Sat, 17 Apr 2021 23:05:31
fourc.calc.wavelength = 1.54
# Sat, 17 Apr 2021 23:05:32
fourc.energy.get()
#[Out]# 8.0
# Sat, 17 Apr 2021 23:05:45
fourc.calc.energy
#[Out]# 8.050922077922078
# Sat, 17 Apr 2021 23:06:21
RE(bp.scan([noisy], fourc.h, .9, 1.1, 3))
#[Out]# ('defd529e-3a8e-4542-a133-e4e747bfd8f1',)
# Sat, 17 Apr 2021 23:06:52
db.v2[-1].primary._descriptors
#[Out]# [Descriptor({'configuration': {'fourc_h': {'data': {}, 'data_keys': {}, 'timestamps': {}},
#[Out]#                    'noisy': {'data': {'noisy': 2572.5328724116844},
#[Out]#                              'data_keys': {'noisy': {'dtype': 'number',
#[Out]#                                                      'lower_ctrl_limit': 0.0,
#[Out]#                                                      'precision': 5,
#[Out]#                                                      'shape': [],
#[Out]#                                                      'source': 'PV:sky:userCalc1',
#[Out]#                                                      'units': '',
#[Out]#                                                      'upper_ctrl_limit': 0.0}},
#[Out]#                              'timestamps': {'noisy': 1618718591.799269}}},
#[Out]#  'data_keys': {'fourc_h': {'dtype': 'number',
#[Out]#                            'lower_ctrl_limit': 0,
#[Out]#                            'object_name': 'fourc_h',
#[Out]#                            'shape': [],
#[Out]#                            'source': 'PY:fourc_h.position',
#[Out]#                            'units': '',
#[Out]#                            'upper_ctrl_limit': 0},
#[Out]#                'fourc_h_setpoint': {'dtype': 'number',
#[Out]#                                     'lower_ctrl_limit': 0,
#[Out]#                                     'object_name': 'fourc_h',
#[Out]#                                     'shape': [],
#[Out]#                                     'source': 'PY:fourc_h.target',
#[Out]#                                     'units': '',
#[Out]#                                     'upper_ctrl_limit': 0},
#[Out]#                'noisy': {'dtype': 'number',
#[Out]#                          'lower_ctrl_limit': 0.0,
#[Out]#                          'object_name': 'noisy',
#[Out]#                          'precision': 5,
#[Out]#                          'shape': [],
#[Out]#                          'source': 'PV:sky:userCalc1',
#[Out]#                          'units': '',
#[Out]#                          'upper_ctrl_limit': 0.0}},
#[Out]#  'hints': {'fourc_h': {'fields': ['fourc_h']}, 'noisy': {'fields': ['noisy']}},
#[Out]#  'name': 'primary',
#[Out]#  'object_keys': {'fourc_h': ['fourc_h', 'fourc_h_setpoint'],
#[Out]#                  'noisy': ['noisy']},
#[Out]#  'run_start': 'defd529e-3a8e-4542-a133-e4e747bfd8f1',
#[Out]#  'time': 1618718781.4644449,
#[Out]#  'uid': '8c81495d-8411-4a53-981f-05c2d787448d'})]
# Sat, 17 Apr 2021 23:08:03
fourc.UB.read()
#[Out]# {'fourc_UB': {'value': array([[ 4.07999046e+00, -2.49827363e-16, -2.49827363e-16],
#[Out]#          [ 0.00000000e+00,  4.07999046e+00, -2.49827363e-16],
#[Out]#          [ 0.00000000e+00,  0.00000000e+00,  4.07999046e+00]]),
#[Out]#   'timestamp': 1618718620.5066028}}
# Sat, 17 Apr 2021 23:10:48
exit()
